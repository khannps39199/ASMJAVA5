<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Giỏ Hàng - Voucher &amp; Số lượng</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Giữ nguyên link CSS của Bootstrap, FontAwesome -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-light">
  <section class="h-100 h-custom" style="background-color: #eee;">
    <div class="container py-5 h-100">
      <div class="row d-flex justify-content-center align-items-center h-100">
        <div class="col">
          <div class="card">
            <div class="card-body p-4">
              
              <!-- Giữ nguyên phần Tiếp tục mua sắm -->
              <h5 class="mb-3">
                <a href="#" class="text-body">
                  <i class="fas fa-long-arrow-alt-left me-2"></i>Tiếp tục mua sắm
                </a>
              </h5>
              <hr>

              <div class="row">
                <!-- Cột trái: Danh sách sản phẩm -->
                <div class="col-lg-7">
                  <div class="d-flex justify-content-between align-items-center mb-4">
                    <div>
                      <p class="mb-1">Giỏ hàng</p>
                      <!-- Ở đây ta không dùng JS để đếm, ta có thể hiển thị server-side -->
                      <p class="mb-0">
                        Bạn có 
                        <span th:text="${#lists.size(cartList)}">0</span>
                        sản phẩm
                      </p>
                    </div>
                  </div>

                  <!-- Form để submit dữ liệu giỏ hàng -->
                  <form th:action="@{/cart/update}" method="post" th:object="${cartUpdateForm}">

                    <!-- Lặp qua cartList -->
                    <div class="card mb-3" th:each="c, stat : ${cartList}">
                      <div class="card-body d-flex justify-content-between align-items-center">

                        <!-- Checkbox chọn mua -->
                        <div class="form-check me-2">
                          <input class="form-check-input" type="checkbox"
                                 th:name="${'cartItemList[' + stat.index + '].selected'}"
                                 th:checked="${true}" />
                        </div>

                        <!-- Hình + Thông tin sản phẩm -->
                        <div class="d-flex flex-row align-items-center">
                          <div>
                            <img th:src="@{'/hinh/' + ${c.product.image}}"
                                 class="img-fluid rounded-3"
                                 alt="Sản phẩm"
                                 style="width: 65px;">
                          </div>
                          <div class="ms-3">
                            <h5 th:text="${c.product.name}">Tên sản phẩm</h5>
                            <p class="small mb-0">
                              Giá: 
                              <span th:text="${c.product.price}"></span> $<br>
                              Số lượng: 
                              <!-- Gán productId ẩn để Controller biết đang cập nhật sp nào -->
                              <input type="hidden"
                                     th:name="${'cartItemList[' + stat.index + '].productId'}"
                                     th:value="${c.product.productID}" />
                              <input type="number"
                                     class="item-quantity"
                                     min="1"
                                     th:name="${'cartItemList[' + stat.index + '].quantity'}"
                                     th:value="${c.quantity}"
                                     style="width: 60px;" />
                            </p>
                          </div>
                        </div>

                        <!-- Nút xóa sản phẩm (có thể là 1 form riêng) -->
                        <div>
                          <form th:action="@{/cart/remove}" method="post">
                            <input type="hidden" name="productId" th:value="${c.product.productID}" />
                            <button type="submit" class="btn" style="color: #cecece;">
                              <i class="fas fa-trash-alt"></i>
                            </button>
                          </form>
                        </div>

                      </div>
                    </div>
                    <!-- end each cartList -->

                    <!-- Mã voucher -->
                    <div class="mb-3">
                      <label for="voucher" class="form-label">Mã Voucher</label>
                      <div class="input-group">
                        <input type="text" class="form-control"
                               th:name="voucherCode"
                               th:value="${voucherCode}"
                               placeholder="Nhập mã voucher">
                      </div>
                    </div>

                    <!-- Hiển thị tạm tính, giảm giá, phí ship, total -->
                    <div class="d-flex justify-content-between">
                      <p class="mb-2">Tạm tính</p>
                      <p class="mb-2">
                        <span th:text="${subTotal}">0</span> $
                      </p>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                      <p class="mb-2">Giảm giá</p>
                      <p class="mb-2">
                        <span th:text="${discount}">0</span> $
                      </p>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                      <p class="mb-2">Phí vận chuyển</p>
                      <p class="mb-2">
                        <span th:text="${shippingFee}">20</span> $
                      </p>
                    </div>
                    <div class="d-flex justify-content-between mb-4">
                      <p class="mb-2">Tổng (Bao gồm thuế)</p>
                      <p class="mb-2">
                        <span th:text="${total}">0</span> $
                      </p>
                    </div>

                    <!-- Nút submit -->
                    <div class="d-flex">
                      <button type="submit" class="btn btn-secondary me-2" name="action" value="update">
                        Cập nhật
                      </button>
                      <button type="submit" class="btn btn-info" name="action" value="checkout">
                        <span>Thanh toán <i class="fas fa-long-arrow-alt-right ms-2"></i></span>
                      </button>
                    </div>

                  </form>
                  <!-- end form -->

                </div>
                <!-- end col-lg-7 -->

                <!-- Cột phải: (nếu bạn muốn tách khu vực tính toán, hiển thị summary, v.v.) -->
                <div class="col-lg-5">
                  <div class="card bg-primary text-white rounded-3">
                    <div class="card-body">
                      <!-- Tùy bạn muốn giữ hay xóa -->
                      <p>Ở đây bạn có thể hiển thị gì tùy ý...</p>
                    </div>
                  </div>
                </div>

              </div> <!-- row -->
            </div> <!-- card-body -->
          </div> <!-- card -->
        </div> <!-- col -->
      </div> <!-- row -->
    </div> <!-- container -->
  </section>
  
  <footer class="bg-dark text-white text-center p-3 mt-4">
    &copy; 2025 - Quản lý Giỏ Hàng
  </footer>

  <!-- Nếu bạn KHÔNG dùng JS để tính, có thể xóa đoạn script dưới -->
  <!-- <script>
     // ... cũ
  </script> -->

</body>
</html>
